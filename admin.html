<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Admin Dashboard</title>
<style>
*{margin:0;padding:0;box-sizing:border-box}
body{font-family:'Segoe UI',system-ui,sans-serif;background:#000;color:#fff;line-height:1.6}
.container{max-width:1400px;margin:0 auto;padding:20px}
h1{font-family:'Playfair Display',serif;font-size:2.2em;margin-bottom:10px;letter-spacing:2px}
.login-section{max-width:400px;margin:50px auto;background:#111;border:1px solid #333;padding:30px}
.login-section input{width:100%;padding:12px;background:#000;border:1px solid #444;color:#fff;margin-bottom:15px}
.login-section button{width:100%;padding:12px;background:#fff;color:#000;border:none;font-weight:700;cursor:pointer}
.tabs{display:flex;gap:2px;margin-bottom:20px;border-bottom:1px solid #333}
.tab{padding:12px 25px;background:#111;border:none;color:#888;cursor:pointer;font-weight:600}
.tab.active{background:#1a1a1a;color:#fff;border-bottom:2px solid #4a9eff}
.section{background:#111;border:1px solid #333;padding:20px;margin-bottom:20px}
.section-title{font-size:1.2em;margin-bottom:15px;font-weight:600}
table{width:100%;border-collapse:collapse;font-size:0.85em}
th,td{text-align:left;padding:10px;border-bottom:1px solid #222}
th{background:#0a0a0a;font-weight:600;color:#888;position:sticky;top:0}
.status-new{color:#4a9eff}
.status-contacted{color:#ff9500}
.status-converted{color:#0f0}
.status-lost{color:#f44}
button.small{padding:6px 12px;background:#222;color:#fff;border:1px solid #444;cursor:pointer;font-size:0.85em;margin:0 2px}
button.small:hover{background:#333}
button.primary{background:#4a9eff;color:#000;border:none}
button.danger{background:#f44;color:#fff;border:none}
input.inline{padding:6px;background:#000;border:1px solid #444;color:#fff;width:80px}
.stats-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(200px,1fr));gap:15px;margin-bottom:20px}
.stat-card{background:#0a0a0a;border:1px solid #333;padding:20px;text-align:center}
.stat-value{font-size:2em;font-weight:700;margin:5px 0}
.stat-label{color:#888;font-size:0.85em}
.hidden{display:none}
.filter-bar{display:flex;gap:10px;margin-bottom:15px;flex-wrap:wrap}
.filter-bar select,.filter-bar input{padding:8px;background:#000;border:1px solid #444;color:#fff}
.creator-badge{background:#1a3a1a;color:#0f0;padding:2px 8px;font-size:0.8em;border:1px solid #0f0}
.modal{position:fixed;top:0;left:0;right:0;bottom:0;background:rgba(0,0,0,0.9);display:flex;align-items:center;justify-content:center;z-index:1000}
.modal-content{background:#111;border:1px solid #333;padding:30px;max-width:500px;width:90%}
.modal-content input,.modal-content select,.modal-content textarea{width:100%;padding:10px;background:#000;border:1px solid #444;color:#fff;margin:10px 0}
.modal-buttons{display:flex;gap:10px;margin-top:20px}
.modal-buttons button{flex:1;padding:12px;cursor:pointer;font-weight:600}
</style>
</head>
<body>
<div class="container">
<div id="loginSection" class="login-section">
<h1 style="font-size:1.8em;text-align:center;margin-bottom:20px">ADMIN LOGIN</h1>
<input type="password" id="adminPass" placeholder="Admin Password">
<button onclick="adminLogin()">LOGIN</button>
</div>

<div id="adminPanel" class="hidden">
<h1>ADMIN DASHBOARD</h1>

<div class="stats-grid">
<div class="stat-card">
<div class="stat-label">TOTAL BOOKINGS</div>
<div class="stat-value status-new" id="statTotal">0</div>
</div>
<div class="stat-card">
<div class="stat-label">NEW</div>
<div class="stat-value status-new" id="statNew">0</div>
</div>
<div class="stat-card">
<div class="stat-label">CONTACTED</div>
<div class="stat-value status-contacted" id="statContacted">0</div>
</div>
<div class="stat-card">
<div class="stat-label">CONVERTED</div>
<div class="stat-value status-converted" id="statConverted">0</div>
</div>
<div class="stat-card">
<div class="stat-label">LOST</div>
<div class="stat-value status-lost" id="statLost">0</div>
</div>
<div class="stat-card">
<div class="stat-label">TOTAL REVENUE</div>
<div class="stat-value" id="statRevenue">₹0</div>
</div>
</div>

<div class="tabs">
<button class="tab active" onclick="showTab('bookings')">BOOKINGS</button>
<button class="tab" onclick="showTab('creators')">CREATORS</button>
<button class="tab" onclick="showTab('coupons')">COUPONS</button>
</div>

<div id="bookingsTab" class="section">
<div class="section-title">ALL BOOKINGS</div>
<div class="filter-bar">
<select id="filterStatus" onchange="filterBookings()">
<option value="">All Status</option>
<option value="new">New</option>
<option value="contacted">Contacted</option>
<option value="converted">Converted</option>
<option value="lost">Lost</option>
</select>
<input type="text" id="searchBooking" placeholder="Search by name/phone" onkeyup="filterBookings()">
<button class="small primary" onclick="loadBookings()">REFRESH</button>
</div>
<div style="max-height:600px;overflow-y:auto">
<table>
<thead>
<tr>
<th>ID</th>
<th>Name</th>
<th>Phone</th>
<th>Service</th>
<th>People</th>
<th>Price</th>
<th>Final Price</th>
<th>Creator</th>
<th>Coupon</th>
<th>Status</th>
<th>Date</th>
<th>Actions</th>
</tr>
</thead>
<tbody id="bookingsBody"></tbody>
</table>
</div>
</div>

<div id="creatorsTab" class="section hidden">
<div class="section-title">CONTENT CREATORS</div>
<button class="small primary" onclick="loadCreators()" style="margin-bottom:15px">REFRESH</button>
<table>
<thead>
<tr>
<th>Name</th>
<th>Phone</th>
<th>Code</th>
<th>Platforms</th>
<th>Views</th>
<th>Conversions</th>
<th>Earnings</th>
<th>Pending</th>
<th>Actions</th>
</tr>
</thead>
<tbody id="creatorsBody"></tbody>
</table>
</div>

<div id="couponsTab" class="section hidden">
<div class="section-title">COUPON CODES</div>
<button class="small primary" onclick="showAddCoupon()">ADD COUPON</button>
<button class="small primary" onclick="loadCoupons()" style="margin-left:10px">REFRESH</button>
<table style="margin-top:15px">
<thead>
<tr>
<th>Code</th>
<th>Discount %</th>
<th>Uses</th>
<th>Max Uses</th>
<th>Expires</th>
<th>Active</th>
<th>Actions</th>
</tr>
</thead>
<tbody id="couponsBody"></tbody>
</table>
</div>
</div>
</div>

<div id="editModal" class="modal hidden">
<div class="modal-content">
<div class="section-title">EDIT BOOKING</div>
<input type="hidden" id="editId">
<label>Status</label>
<select id="editStatus">
<option value="new">New</option>
<option value="contacted">Contacted</option>
<option value="converted">Converted</option>
<option value="lost">Lost</option>
</select>
<label>Final Price (₹)</label>
<input type="number" id="editPrice">
<label>Notes</label>
<textarea id="editNotes" rows="3"></textarea>
<div class="modal-buttons">
<button onclick="saveBooking()" style="background:#0f0;color:#000">SAVE</button>
<button onclick="closeModal()" style="background:#222;color:#fff">CANCEL</button>
</div>
</div>
</div>

<div id="couponModal" class="modal hidden">
<div class="modal-content">
<div class="section-title">ADD COUPON</div>
<label>Code</label>
<input type="text" id="couponCode">
<label>Discount %</label>
<input type="number" id="couponDiscount" min="1" max="100">
<label>Max Uses</label>
<input type="number" id="couponMax" value="100">
<label>Expires (days)</label>
<input type="number" id="couponExpiry" value="30">
<div class="modal-buttons">
<button onclick="saveCoupon()" style="background:#0f0;color:#000">CREATE</button>
<button onclick="document.getElementById('couponModal').classList.add('hidden')" style="background:#222;color:#fff">CANCEL</button>
</div>
</div>
</div>

<script>
const WEB_APP_URL='https://script.google.com/macros/s/AKfycbz2FBtwYXswBTPtoF5zhpo1QWUtVn4VhZ_r7_duDf4oafOvxG6z5BAxJbfFvzq2MlSaTQ/exec';
const ADMIN_PASS='admin123';

function adminLogin(){
if(document.getElementById('adminPass').value===ADMIN_PASS){
document.getElementById('loginSection').classList.add('hidden');
document.getElementById('adminPanel').classList.remove('hidden');
loadDashboard();
}else alert('Invalid password');
}

function loadDashboard(){
loadBookings();
loadStats();
}

function loadStats(){
fetch(`${WEB_APP_URL}?action=getAdminStats`)
.then(r=>r.json())
.then(d=>{
document.getElementById('statTotal').textContent=d.total||0;
document.getElementById('statNew').textContent=d.new||0;
document.getElementById('statContacted').textContent=d.contacted||0;
document.getElementById('statConverted').textContent=d.converted||0;
document.getElementById('statLost').textContent=d.lost||0;
document.getElementById('statRevenue').textContent='₹'+(d.revenue||0);
});
}

function loadBookings(){
fetch(`${WEB_APP_URL}?action=getBookings`)
.then(r=>r.json())
.then(d=>{
const tbody=document.getElementById('bookingsBody');
tbody.innerHTML='';
window.allBookings=d.bookings||[];
filterBookings();
});
}

function filterBookings(){
const status=document.getElementById('filterStatus').value;
const search=document.getElementById('searchBooking').value.toLowerCase();
const filtered=window.allBookings.filter(b=>
(!status||b.status===status)&&
(!search||b.name.toLowerCase().includes(search)||b.phone.includes(search))
);
const tbody=document.getElementById('bookingsBody');
tbody.innerHTML='';
filtered.forEach(b=>{
const tr=document.createElement('tr');
tr.innerHTML=`
<td>${b.id}</td>
<td>${b.name}</td>
<td><a href="tel:${b.phone}" style="color:#4a9eff">${b.phone}</a></td>
<td>${b.service}</td>
<td>${b.people}</td>
<td>₹${b.basePrice}</td>
<td>₹${b.finalPrice}</td>
<td>${b.isCreator?'<span class="creator-badge">'+b.creatorCode+'</span>':'-'}</td>
<td>${b.coupon||'-'}</td>
<td class="status-${b.status}">${b.status.toUpperCase()}</td>
<td>${b.date}</td>
<td>
<button class="small" onclick="editBooking('${b.id}')">EDIT</button>
<button class="small" onclick="callCustomer('${b.phone}')">CALL</button>
</td>
`;
tbody.appendChild(tr);
});
}

function editBooking(id){
const booking=window.allBookings.find(b=>b.id===id);
document.getElementById('editId').value=id;
document.getElementById('editStatus').value=booking.status;
document.getElementById('editPrice').value=booking.finalPrice;
document.getElementById('editNotes').value=booking.notes||'';
document.getElementById('editModal').classList.remove('hidden');
}

function saveBooking(){
const id=document.getElementById('editId').value;
const status=document.getElementById('editStatus').value;
const price=document.getElementById('editPrice').value;
const notes=document.getElementById('editNotes').value;
fetch(WEB_APP_URL,{method:'POST',body:JSON.stringify({
action:'updateBooking',
id,status,finalPrice:price,notes
})})
.then(r=>r.json())
.then(d=>{
if(d.success){
alert('Updated!');
closeModal();
loadBookings();
loadStats();
}else alert('Error');
});
}

function closeModal(){
document.getElementById('editModal').classList.add('hidden');
}

function callCustomer(phone){
window.open(`tel:${phone}`);
}

function loadCreators(){
fetch(`${WEB_APP_URL}?action=getAllCreators`)
.then(r=>r.json())
.then(d=>{
const tbody=document.getElementById('creatorsBody');
tbody.innerHTML='';
(d.creators||[]).forEach(c=>{
const tr=document.createElement('tr');
tr.innerHTML=`
<td>${c.name}</td>
<td>${c.phone}</td>
<td><strong>${c.code}</strong></td>
<td>${c.platforms}</td>
<td>${c.views}</td>
<td>${c.conversions}</td>
<td>₹${c.earnings}</td>
<td>₹${c.pending}</td>
<td><button class="small" onclick="payCreator('${c.code}')">PAY OUT</button></td>
`;
tbody.appendChild(tr);
});
});
}

function payCreator(code){
if(confirm('Mark all pending earnings as paid?')){
fetch(WEB_APP_URL,{method:'POST',body:JSON.stringify({action:'payoutCreator',code})})
.then(r=>r.json())
.then(d=>{
if(d.success){alert('Paid!');loadCreators();}
});
}
}

function loadCoupons(){
fetch(`${WEB_APP_URL}?action=getCoupons`)
.then(r=>r.json())
.then(d=>{
const tbody=document.getElementById('couponsBody');
tbody.innerHTML='';
(d.coupons||[]).forEach(c=>{
const tr=document.createElement('tr');
tr.innerHTML=`
<td><strong>${c.code}</strong></td>
<td>${c.discount}%</td>
<td>${c.uses}</td>
<td>${c.maxUses}</td>
<td>${c.expires}</td>
<td>${c.active?'✓':'✗'}</td>
<td><button class="small danger" onclick="deleteCoupon('${c.code}')">DELETE</button></td>
`;
tbody.appendChild(tr);
});
});
}

function showAddCoupon(){
document.getElementById('couponModal').classList.remove('hidden');
}

function saveCoupon(){
const code=document.getElementById('couponCode').value.trim().toUpperCase();
const discount=document.getElementById('couponDiscount').value;
const max=document.getElementById('couponMax').value;
const expiry=document.getElementById('couponExpiry').value;
if(!code||!discount){alert('Fill all fields');return}
fetch(WEB_APP_URL,{method:'POST',body:JSON.stringify({
action:'createCoupon',code,discount,maxUses:max,expiryDays:expiry
})})
.then(r=>r.json())
.then(d=>{
if(d.success){
alert('Coupon created!');
document.getElementById('couponModal').classList.add('hidden');
loadCoupons();
}
});
}

function deleteCoupon(code){
if(confirm('Delete '+code+'?')){
fetch(WEB_APP_URL,{method:'POST',body:JSON.stringify({action:'deleteCoupon',code})})
.then(r=>r.json())
.then(d=>{if(d.success)loadCoupons()});
}
}

function showTab(tab){
document.querySelectorAll('.tab').forEach(t=>t.classList.remove('active'));
event.target.classList.add('active');
document.getElementById('bookingsTab').classList.add('hidden');
document.getElementById('creatorsTab').classList.add('hidden');
document.getElementById('couponsTab').classList.add('hidden');
if(tab==='bookings'){document.getElementById('bookingsTab').classList.remove('hidden');loadBookings()}
if(tab==='creators'){document.getElementById('creatorsTab').classList.remove('hidden');loadCreators()}
if(tab==='coupons'){document.getElementById('couponsTab').classList.remove('hidden');loadCoupons()}
}
</script>
</body>
</html>